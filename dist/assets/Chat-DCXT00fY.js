import{_,c as n,a,b as h,d as k,F as b,r as M,v as C,q as S,f as l,g as U,h as c,o as r,i as w,e as V,t as d,s as T}from"./index-DVPIYTm0.js";const D={name:"Chat",setup(){const m=JSON.parse(localStorage.getItem("user")),t=m==null?void 0:m.id,g=l([]),s=l(""),v=l([]),i=l(""),e=l({}),y=async()=>{const o=await c.get("http://localhost:3001/profesori");g.value=o.data.filter(u=>u.id!==t),await p()},p=async()=>{const o=await c.get(`http://localhost:3001/messages/unread/${t}`);e.value=o.data},f=async()=>{if(!s.value)return;await c.post("http://localhost:3001/messages/mark-read",{senderId:s.value,receiverId:t});const o=await c.get(`http://localhost:3001/messages/${t}/${s.value}`);v.value=o.data,await p()},I=async()=>{!i.value.trim()||!s.value||(await c.post("http://localhost:3001/messages",{senderId:t,receiverId:s.value,content:i.value}),i.value="",f())},x=o=>{const u=new Date(o);return`${u.toLocaleDateString()} u ${u.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`};return U(()=>{y()}),{currentUserId:t,professors:g,selectedRecipientId:s,messages:v,newMessage:i,fetchMessages:f,sendMessage:I,unreadMessages:e,formatTimestamp:x}}},N={class:"container my-5"},O={class:"mb-4"},B=["value"],L={key:0,class:"text-danger"},R={class:"chat-box mb-3 p-3 rounded shadow-sm"},z={class:"mb-1"},F={class:"text-muted"},K={class:"input-group"};function P(m,t,g,s,v,i){return r(),n("div",N,[t[7]||(t[7]=a("h2",{class:"mb-4 text-primary text-center"},"ğŸ“¬ Chat s profesorima",-1)),a("div",O,[t[6]||(t[6]=a("label",{class:"form-label"},"Odaberi profesora:",-1)),h(a("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>s.selectedRecipientId=e),class:"form-select",onChange:t[1]||(t[1]=(...e)=>s.fetchMessages&&s.fetchMessages(...e))},[t[5]||(t[5]=a("option",{disabled:"",value:""},"-- Odaberi --",-1)),(r(!0),n(b,null,M(s.professors,e=>(r(),n("option",{key:e.id,value:e.id},[w(d(e.ime)+" "+d(e.prezime)+" ",1),s.unreadMessages[e.id]?(r(),n("span",L,"("+d(s.unreadMessages[e.id])+" nova)",1)):V("",!0)],8,B))),128))],544),[[k,s.selectedRecipientId]])]),a("div",R,[(r(!0),n(b,null,M(s.messages,e=>(r(),n("div",{key:e.id,class:T(["message-bubble",e.senderId===s.currentUserId?"sent":"received"])},[a("p",z,[a("strong",null,d(e.senderId===s.currentUserId?"Vi":"On")+":",1),w(" "+d(e.content),1)]),a("small",F,d(s.formatTimestamp(e.timestamp)),1)],2))),128))]),a("div",K,[h(a("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>s.newMessage=e),type:"text",class:"form-control",placeholder:"UpiÅ¡i poruku...",onKeyup:t[3]||(t[3]=S((...e)=>s.sendMessage&&s.sendMessage(...e),["enter"]))},null,544),[[C,s.newMessage]]),a("button",{class:"btn btn-primary",onClick:t[4]||(t[4]=(...e)=>s.sendMessage&&s.sendMessage(...e))},"PoÅ¡alji")])])}const q=_(D,[["render",P],["__scopeId","data-v-f0a104b3"]]);export{q as default};
